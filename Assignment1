import pandas as pd
import os

try:
    # Load the dataset
    print("Loading dataset...")
    data = pd.read_csv('morg-2014-emp.csv')
    print(f"Dataset loaded successfully. Shape: {data.shape}")
    
    # Filter for legal occupations (codes 2100-2160)
    legal_data = data[(data['occ2012'] >= 2100) & (data['occ2012'] <= 2160)]
    print(f"Legal occupations data extracted: {legal_data.shape[0]} rows")
    
    if legal_data.shape[0] > 0:
        # Calculate earnings per hour
        legal_data['earnhre'] = legal_data['earnwke'] / legal_data['uhours']
        
        # Save to CSV file
        output_file = 'legal_occupations.csv'
        legal_data.to_csv(output_file, index=False)
        print(f"Data successfully saved to {output_file}")
    else:
        print("No legal occupation data found with codes 2100-2160")
        
except Exception as e:
    print(f"Error: {e}")
